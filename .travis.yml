os: windows
language: shell

env:
  global:
    - GOVERSION: 1.11.5
    - NODEJS_VERSION: 11.9.0

before_install:
  - git clone https://github.com/portapps/portapps ${TRAVIS_BUILD_DIR}/../portapps
  - source ${TRAVIS_BUILD_DIR}/../portapps/.travis/prepare.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/java.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/ant.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/nodejs.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/go.sh
  - set

script:
  - ant release

after_success:
  - export APP_VERSION=$(cat $TRAVIS_BUILD_DIR/bin/tmp/version.dat)
  - echo ${APP_VERSION}

before_deploy:
  - git config --local user.email "builds@travis-ci.com"
  - git config --local user.name "Travis CI"
  - export TRAVIS_TAG="${APP_VERSION}"
  - git tag $TRAVIS_TAG
  - ls -al bin/release

deploy:
  provider: releases
  api_key:
    secure: bgpaEGohhuqlv8En/jMoy3wmJUJf4rv2NczPQg2169LBrSkwMrEnnE1pkBM/2cmMjWHecyp18gOXc7BbRcqDKVxVmBkJWVtAYVnT5zzwz1cT0jiENstXGxw79P1pGWc7IhXDN9Nm7fiGPQHvR1nMhUh//Dj7WOFfFm2w4q3Rmq7cnZdoL/qt5fJ2BYkH2qItL4A/Wp65C560t5/edTBmlY0zPOqaXENlsv5RccQ0qE8chtNGGoa4W4Atr17OuhUvcdvNX+owhime20OG+PcdxqU3RISAOeUEag8gDt6TgsVPcLuoxLvzlwjwAhP7CYyaje7yIpJfxltTUOBpLHaM0GBKYBub7t/DKmJqWqHgdSMt8MQlBn8SmrVzMEsRmUXR4EFR8x3HO/Z1soGNoDHUWl9x5skifynOr1HJ8tcFW1AOBbXMLV3R/O0I6npKEmPRe5X8sDV6yo9WeB5wMSPMLWZT72QWucU83l3PMakaxNdiLDy8UDnaZqBy9OjKdyuTQiIf6WDUV+hAusZZ0B/hJnM+xmlEz4fT9KXIQ7Oj2dAG8wAOVJGVSvQvodvH3sLpKnQ4w1eC1Hfydcq56Bm1WYDKsjORZ+PrZXYxATrzW1ZgLJmS9st3E/LUlA8SFzWDEorODQPK1VGUh+mZF7TJqqS2XhYx34MtSXr0Ml7VaXU=
  file_glob: true
  file: bin/release/*
  skip_cleanup: true
  draft: true
  on:
    tags: false
